<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>moveBankProjet: updateEvent.cpp File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">moveBankProjet
   &#160;<span id="projectnumber">0.1</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">updateEvent.cpp File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>This program updates events from the MoveBank web service.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &lt;iostream&gt;</code><br />
<code>#include &lt;stdio.h&gt;</code><br />
<code>#include &lt;string&gt;</code><br />
<code>#include &lt;filesystem&gt;</code><br />
<code>#include &lt;iomanip&gt;</code><br />
<code>#include &quot;<a class="el" href="myFunctions_8h_source.html">myFunctions.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="request_8h_source.html">request.h</a>&quot;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for updateEvent.cpp:</div>
<div class="dyncontent">
<div class="center"><img src="updateEvent_8cpp__incl.png" border="0" usemap="#aupdateEvent_8cpp" alt=""/></div>
<map name="aupdateEvent_8cpp" id="aupdateEvent_8cpp">
<area shape="rect" title="This program updates events from the MoveBank web service." alt="" coords="327,5,457,32"/>
<area shape="rect" title=" " alt="" coords="352,155,432,181"/>
<area shape="rect" title=" " alt="" coords="5,155,72,181"/>
<area shape="rect" title=" " alt="" coords="456,155,515,181"/>
<area shape="rect" title=" " alt="" coords="539,155,629,181"/>
<area shape="rect" title=" " alt="" coords="253,155,328,181"/>
<area shape="rect" href="myFunctions_8h.html" title="Header file containing functions for date and gd image processing." alt="" coords="156,80,273,107"/>
<area shape="rect" href="request_8h.html" title="This file contains the implementation of the moveBankRequests class constructor and methods." alt="" coords="543,80,625,107"/>
<area shape="rect" title=" " alt="" coords="96,155,155,181"/>
<area shape="rect" title=" " alt="" coords="179,155,229,181"/>
<area shape="rect" title=" " alt="" coords="654,155,741,181"/>
<area shape="rect" title=" " alt="" coords="765,155,838,181"/>
<area shape="rect" title=" " alt="" coords="863,155,935,181"/>
</map>
</div>
</div>
<p><a href="updateEvent_8cpp_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ae66f6b31b5ad750f1fe042a706a4e3d4"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="updateEvent_8cpp.html#ae66f6b31b5ad750f1fe042a706a4e3d4">main</a> ()</td></tr>
<tr class="memdesc:ae66f6b31b5ad750f1fe042a706a4e3d4"><td class="mdescLeft">&#160;</td><td class="mdescRight">This is the main function of the update part of this program current.  <a href="updateEvent_8cpp.html#ae66f6b31b5ad750f1fe042a706a4e3d4">More...</a><br /></td></tr>
<tr class="separator:ae66f6b31b5ad750f1fe042a706a4e3d4"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>This program updates events from the MoveBank web service. </p>

<p class="definition">Definition in file <a class="el" href="updateEvent_8cpp_source.html">updateEvent.cpp</a>.</p>
</div><h2 class="groupheader">Function Documentation</h2>
<a id="ae66f6b31b5ad750f1fe042a706a4e3d4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae66f6b31b5ad750f1fe042a706a4e3d4">&#9670;&nbsp;</a></span>main()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int main </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This is the main function of the update part of this program current. </p>
<p>This main function updates events from the MoveBank database. It reads the last update date using lastDateUpdate.txt date file and uses that date to get the new events. The results are saved in the outputUpdateEvent.txt file. Then, the update date is updated to the current date and stored in lastDateUpdate.txt file again.</p>
<dl class="section return"><dt>Returns</dt><dd>0 on success. </dd></dl>

<p class="definition">Definition at line <a class="el" href="updateEvent_8cpp_source.html#l00027">27</a> of file <a class="el" href="updateEvent_8cpp_source.html">updateEvent.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;           {</div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160; </div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;    <span class="comment">// Get last date</span></div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">char</span>* homeDir = getenv(<span class="stringliteral">&quot;HOME&quot;</span>);</div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;    ifstream filedate(<span class="keywordtype">string</span>(homeDir) + <span class="stringliteral">&quot;/moveBankProjet/data/lastDateUpdate.txt&quot;</span>);</div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;    <span class="keywordtype">string</span> laDate;</div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;    <span class="keywordtype">string</span> lastDate;</div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;    <span class="keywordflow">while</span> (getline(filedate, laDate)) {</div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;        lastDate=laDate;}</div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;    filedate.close();</div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160; </div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;    <span class="comment">// Get md5 hash</span></div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;    ifstream fileMd5(<span class="keywordtype">string</span>(homeDir) + <span class="stringliteral">&quot;/moveBankProjet/data/md5Value.txt&quot;</span>);</div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;    <span class="keywordtype">string</span> md5;</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;    <span class="keywordtype">string</span> md5Value;</div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;    <span class="keywordflow">while</span> (getline(fileMd5, md5)) {</div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;        md5Value=md5;}</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;    filedate.close();</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;    <span class="keywordtype">string</span> currentDate = <a class="code" href="myFunctions_8h.html#ac919c3950b37172c5ef02a12d27254b4">currentDateTime</a>()+<span class="stringliteral">&quot;000&quot;</span>;</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160; </div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;    <span class="comment">// Configure the URL for updating events</span></div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;    <span class="keywordtype">string</span> studyName = <span class="stringliteral">&quot;1266784970&quot;</span>;</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;    <span class="keywordtype">string</span> updateEventUrl = <span class="stringliteral">&quot;https://www.movebank.org/movebank/service/direct-read?entity_type=event&amp;study_id=&quot;</span>+studyName+<span class="stringliteral">&quot;&amp;timestamp_start=&quot;</span>+lastDate+<span class="stringliteral">&quot;&amp;timestamp_end=&quot;</span>+currentDate+<span class="stringliteral">&quot;&amp;license-md5=&quot;</span>+md5Value;</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;    <span class="keywordtype">string</span> updateEventFilePath = string(homeDir) + <span class="stringliteral">&quot;/moveBankProjet/data/outputUpdateEvent.txt&quot;</span>;</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;    <a class="code" href="classmoveBankRequests.html">moveBankRequests</a> newRequestUpdateEvent(updateEventUrl,updateEventFilePath);</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;    newRequestUpdateEvent.eventUpdateparsing(homeDir,updateEventFilePath);</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160; </div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;    <span class="comment">// Last date become the current date for the next update event</span></div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;    ofstream fileDate(<span class="keywordtype">string</span>(homeDir) + <span class="stringliteral">&quot;/moveBankProjet/data/lastDateUpdate.txt&quot;</span>);</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;    fileDate &lt;&lt; currentDate &lt;&lt; endl;</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;    fileDate.close();</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;}</div>
<div class="ttc" id="aclassmoveBankRequests_html"><div class="ttname"><a href="classmoveBankRequests.html">moveBankRequests</a></div><div class="ttdoc">This class is used to make requests to moveBank database (moveBank.org)</div><div class="ttdef"><b>Definition:</b> <a href="request_8h_source.html#l00024">request.h:24</a></div></div>
<div class="ttc" id="amyFunctions_8h_html_ac919c3950b37172c5ef02a12d27254b4"><div class="ttname"><a href="myFunctions_8h.html#ac919c3950b37172c5ef02a12d27254b4">currentDateTime</a></div><div class="ttdeci">string currentDateTime()</div><div class="ttdoc">Get the current date and time as a string.</div><div class="ttdef"><b>Definition:</b> <a href="myFunctions_8cpp_source.html#l00013">myFunctions.cpp:13</a></div></div>
</div><!-- fragment -->
</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
